		<div class="modal-header">
			<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
			<h3>事务活动</h3>
		</div>
		<div class="modal-body">
			<ul class="nav nav-tabs">
  			<li class="temple info active">
    			<a href="#">基本信息</a>
  			</li>
  			<li class="temple add">
    			<a href="#">添加应用</a>
  			</li>
  			 <li class="temple extend">
    			<a href="#">扩展属性</a>
  			</li>
			</ul>
			<div id="content1" class="content">
				<form class="form-horizontal">
  					<div class="control-group">
    					<label class="control-label" for="inputEmail">名称</label>
    					<div class="controls">
      						<input type="text" id="name" placeholder="name">
    					</div>
 					</div>
				  	<div class="control-group">
				   		<label class="control-label" for="inputPassword">参与者</label>
				    	<div class="controls">
				   	   		<input type="text" id="inputPassword">
				    	</div>
				  	</div>
				  	<div class="control-group">
				   		<label class="control-label" for="inputPassword">描述</label>
				    	<div class="controls">
				   	   		<textarea rows="5" class="basic_info">...
				   	   		</textarea>
				    	</div>
				  	</div>
				</form>
			</div>
			<div id="content2" class="hide content">
				<form class="form-horizontal">
  					<div class="control-group">
    					<label class="control-label" for="inputEmail">应用类型</label>
    					<div class="controls">
							 <select class="app_type">
								<option value="SendRemindMessage">发送提醒</option>
							  	<option value="SaveBusinessFormData">存业务数据</option>
							  	<option value="GetBusinessFormData">取业务数据</option>
							  	<option value="EditBusinessFormData">修改业务数据</option>
							</select>
    					</div>
 					</div>
				  	<div class="hide control-group send app">
				   		<label class="control-label">收件人类型</label>
				    	<div class="controls">
							<select class="receive_type">
							  <option value="user">用户</option>
							  <option value="role">角色</option>
							  <option value="ActualParameters">实参</option>
							</select>
				    	</div>
				  	</div>
				  	<div class="hide control-group send app">
				   		<label class="control-label">收件人</label>
				    	<div class="controls">
							<select class="receive_id">							  
							  <option class="temple hide"></option>
							</select>
				    	</div>
				  	</div>
				  	<div class="hide control-group send app">
				   		<label class="control-label">收件人(实参)</label>
				    	<div class="controls">
							<input type="text" class="receive_actual" placeholder="name">
				    	</div>
				  	</div>
				  	<div class="hide control-group send app">
				   		<label class="control-label" for="inputPassword">描述</label>
				    	<div class="controls">
				   	   		<textarea rows="5" class="app_info">...
				   	   		</textarea>
				    	</div>
				  	</div>
				  	<div class="control-group get app">
				  		<label class="control-label"  style="padding:0px">
				  				<select class="span3 Module">							  
								  <option class="hide temple"></option>
								</select></label>
				    	<div class="controls" style="margin-left:240px">
								<select class="span3 Field">							  
								  <option class="hide temple"></option>
								</select>
								<a href="#" class="btn btn-primary addActualParam" style="margin-left:20px">确定</a>
				    	</div>
				  	</div>
				  	<div class="control-group save app">
				  		<label class="control-label"  style="padding:0px">
				  				<select class="span3 Module" placeholder="Module">							  
								  <option class="hide temple"></option>
								</select></label>
				    	<div class="controls" style="margin-left:240px">
								<select class="span3 Field">							  
								  <option class="hide temple"></option>
								</select>
				    	</div>
				  	</div>
				  	<div class="control-group save app">
				  		<label class="control-label"  style="padding:0px">
				  				<select class="span2 ActualParamType" style="float:left">							  
								  <option value="user">系统用户</option>
								  <option value="param">流程变量</option>
								  <option value="humantask">指定任务完成人</option>
								</select></label>
				    	<div class="controls">
				    			<input type="text" class="hide ActualParam" placeholder="流程变量"/>
								<select class="span2 ActualParam">							  
								  <option class="hide temple"></option>
								</select>
								<input type="text" class="recordID" placeholder="记录ID" style="width:106px;margin-left:40px"/>
								<a href="#" class="btn btn-primary addActualParam" style="margin-left:20px">确定</a>
				    	</div>
				  	</div>
				</form>
				<table class="table table-condensed get app">
		              <thead>
		                <tr class="head hide">
		                  <th width="10%">#</th>
		                  <th width="16%">模块ID</th>
		                  <th width="16%">模块名</th>
		                  <th width="16%">字段ID</th>
		                  <th width="16%">字段名</th>
		                  <th width="16%">实参名</th>
		                  <th width="10%">操作</th>
		                </tr>
		              </thead>
		              <tbody>
		                <tr class="hide temple">
		                  <td class="id" style="vertical-align:middle">0</td>
		                  <td class="moduleID" style="vertical-align:middle"><span style="">Mushi</span></td>
		                  <td class="module" style="vertical-align:middle"><span style="">Mushi</span></td>
		                  <td class="fieldID" style="vertical-align:middle">3ice</td>
		                  <td class="field" style="vertical-align:middle">3ice</td>
		                  <td class="actualParam" style="vertical-align:middle"><input type="text" class="input-small" style="margin-bottom:1px;padding:2px" title="实参"></td>
		                  <td class="oper" style="vertical-align:middle"><button class="btn btn-danger btn-mini">删除</button></td>
		                </tr>
		              </tbody>
	            </table>
	            <table class="table table-condensed save app">
		              <thead>
		                <tr class="head hide">
		                  <th width="5%">#</th>
		                  <th width="13%">模块ID</th>
		                  <th width="13%">模块名</th>
		                  <th width="13%">字段ID</th>
		                  <th width="13%">字段名</th>
		                  <th width="13%">实参名</th>
		                  <th width="13%">记录ID</th>
		                  <th width="13%">操作</th>
		                </tr>
		              </thead>
		              <tbody>
		                <tr class="hide temple">
		                  <td class="id" style="vertical-align:middle">0</td>
		                  <td class="moduleID" style="vertical-align:middle"><span style="">Mushi</span></td>
		                  <td class="module" style="vertical-align:middle"><span style="">Mushi</span></td>
		                  <td class="fieldID" style="vertical-align:middle">3ice</td>
		                  <td class="field" style="vertical-align:middle">3ice</td>
		                  <td class="ActualParam" style="vertical-align:middle">LaNm</td>
		                  <td class="recordID" style="vertical-align:middle">attend</td>
		                  <td class="oper" style="vertical-align:middle"><button class="btn btn-danger btn-mini">删除</button></td>
		                </tr>
		              </tbody>
	            </table>
			</div>
			<div id="content3" class="content"></div>
			<div class="btn-group">
            	<a class="btn btn-danger pull-left" style="margin-left:10px" href="#">我要删除</a>
	            <a class="btn btn-success pull-left disabled" href="#">我不删除</a>
            </div>
		</div>
		<div class="modal-footer">
			<a href="#" data-dismiss="modal" class="btn">取消</a>
			<a href="#" class="btn btn-primary activity submit" data-loading-text="正在添加">确定</a>
		</div>
<script type="text/javascript">
  	$(function(){
  		$(".btn-danger").bind("click",function(){
  			$(this).addClass("disabled");
  			$(".btn-success").removeClass("disabled");
  		});
  		$(".btn-success").bind("click",function(){
  			$(this).addClass("disabled");
  			$(".btn-danger").removeClass("disabled");
  		});
  		$(".activity.submit").bind("click",function(){
  			$('#new_course_dialog').trigger("submit",["pojo"]);
  			$('#new_course_dialog').modal('hide');
  		});
  		var $navs = $('.nav > li ');
		//var $content = $('.modal-body').find("#content");
		//$content.html(new Date()+"");
		$navs.on('click', function(){			
			$navs.removeClass("active");
			$(this).addClass("active");
			//$content.html(new Date()+"");
			$navs.each(function(index,e){
				if($(e).hasClass("active")){
					$(".content").addClass("hide");
					$("#content"+(index+1)).removeClass("hide");
				}
			});
		});
		//取数据业务中的添加实参到表格
		$(".get .btn.addActualParam").bind("click",function(){
			$("table.get").find("tr.head").removeClass("hide");
			var line=$("table.get").find("tr.temple").clone();
			line.removeClass("hide temple");
			line.addClass("actual");
			var n=$("table.get tr:last-child:eq(1)").find("td.id").text();
			n++;
			line.find("td.id").text(n);
			line.find("td.moduleID").text($(".get select.Module").find("option:selected").data("id"));
			line.find("td.module").text($(".get select.Module").find("option:selected").val());
			line.find("td.fieldID").text($(".get select.Field").find("option:selected").data("id"));
			line.find("td.field").text($(".get select.Field").find("option:selected").val());
			line.find(".btn-danger").bind("click",function(){
				$(this).parents("tr:eq(0)").remove();
				if($("table.get tr:not(.temple)").length==1){
					$("table.get").find("tr.head").addClass("hide");
				}
			});
			line.appendTo($("table.get"));
		});
		//存数据业务中添加实参到表格
		$(".save .btn.addActualParam").bind("click",function(){
			$("table.save").find("tr.head").removeClass("hide");
			var line=$("table.save").find("tr.temple").clone();
			line.removeClass("hide temple");
			line.addClass("actual");
			var n=$("tr:last-child:eq(1)").find("td.id").text();
			n++;
			line.find("td.id").text(n);
			line.find("td.moduleID").text($(".save select.Module").find("option:selected").data("id"));
			line.find("td.module").text($(".save select.Module").find("option:selected").val());
			line.find("td.fieldID").text($(".save select.Field").find("option:selected").data("id"));
			line.find("td.field").text($(".save select.Field").find("option:selected").val());
			var type=$("select.ActualParamType").val();
			if(type=='user'){
				var str="#"+$(".save .ActualParam:not(.hide)").val();
			}else if(type=='humantask'){
				var str="$"+$(".save .ActualParam:not(.hide)").val();
			}else{
				var str=$(".save .ActualParam:not(.hide)").val();
			}
			line.find("td.ActualParam").text(str);
			line.find("td.recordID").text($("div.save .recordID").val());
			line.find(".btn-danger").bind("click",function(){
				$(this).parents("tr:eq(0)").remove();
				if($("tr:not(.temple)").length==1){
					$("table.save").find("tr.head").addClass("hide");
				}
			});
			line.appendTo($("table.save"));
		});
		$("select.ActualParamType").bind("change",function(e){
			var s=$(this).val();
			if(s=="user"){
				Model.findAllUsers().done(function(data){
					Model.fillInUsers(data,$(".save select.ActualParam"));
				});
			}
		});
		//确定显示什么应用的界面并填写已经填写过的数据
		$("select.app_type").bind("change",function(e,callbacks){
			var s=$(this).val();
			var callbacks = callbacks || $.Callbacks();
			$(".app").addClass("hide");
			if(s.toLocaleLowerCase().indexOf("send")>=0){
				$(".send").removeClass("hide");
				Model.findAllUsers().done(Model.fillInUsers).done(function(){
					callbacks.fire();
				});
			}
			if(s.toLocaleLowerCase().indexOf("get")>=0){
				$(".get").removeClass("hide");
				//$(".get").find("option").addClass("hide");
				Model.findAllDynamicModuleMetaData().done(Model.fillInAllDynamicModuleMetaData).done(function(){
					callbacks.fire();
				});
			}
			if(s.toLocaleLowerCase().indexOf("save")>=0){
				$(".save").removeClass("hide");
				$("select.ActualParamType").trigger("change");
				Model.findAllDynamicModuleMetaData().done(Model.fillInAllDynamicModuleMetaData).done(function(){
					callbacks.fire();
				});
			}
		});
		//获得动态表单中的字段
		$("select.Module").bind("change",function(e,callbacks){
			var index=$(this).find("option:selected").data("id");
			var data1={"moduleId":index};
			var callbacks=callbacks || $.Callbacks();
			$("select.Field option:not(.temple)").remove();
			Model.findFieldbyDynamicModule(data1).done(Model.fillInFieldbyDynamicModule).done(function(){
				callbacks.fire();
			});	
		});
		//获得接收对象的二级菜单
		$("select.receive_type").bind("change",function(e,callbacks){
			var callbacks = callbacks || $.Callbacks();
			var s=$(this).val();
			//alert("");
			console.log(s);
			$("select.receive_id option:not(.temple)").remove();
			if(s=="user"){
				Model.findAllUsers().done(Model.fillInUsers).done(function(){
					callbacks.fire();
				});				
			}
			else if(s=="role"){
				Model.findAllRolesList().done(Model.fillInAllRolesList).done(function(){
					callbacks.fire();
				});
			}else{
				callbacks.fire();
			}
		});
  	});
</script>